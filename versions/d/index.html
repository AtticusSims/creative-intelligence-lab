<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CIL — Version D: ASCII Immersive</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --font: 'Space Grotesk', system-ui, sans-serif;
            --black: #080a12;
            --white: #f0ede8;
            --dim: rgba(240,237,232,0.4);
            --accent: #4d6aff;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font);
            background: var(--black);
            color: var(--white);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* === ASCII CANVAS === */
        #ascii-canvas {
            position: fixed;
            inset: 0;
            z-index: 0;
        }
        #ascii-canvas canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* === SCROLL CONTENT OVER 3D === */
        .scroll-content {
            position: relative;
            z-index: 1;
            pointer-events: none;
        }
        .scroll-content a,
        .scroll-content button,
        .scroll-content nav { pointer-events: auto; }
        section { pointer-events: auto; }

        /* === NAV === */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 200;
            padding: 1.25rem 2.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            color: var(--white);
            text-decoration: none;
        }
        .nav-links {
            list-style: none;
            display: flex;
            gap: 2rem;
        }
        .nav-links a {
            font-size: 0.7rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--dim);
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-links a:hover { color: var(--white); }

        /* === HERO (transparent, 3D shows through) === */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }
        .hero h1 {
            font-size: clamp(3.5rem, 10vw, 8rem);
            font-weight: 700;
            line-height: 0.9;
            letter-spacing: -0.04em;
            mix-blend-mode: difference;
        }
        .hero-sub {
            font-size: 0.85rem;
            color: var(--dim);
            max-width: 450px;
            margin: 1.5rem auto 0;
            letter-spacing: 0.02em;
        }
        .hero-label {
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--dim);
            margin-bottom: 1.5rem;
        }

        /* === SECTIONS === */
        .s-pad {
            padding: clamp(2.5rem, 5vw, 4rem) 2.5rem;
        }
        .glass {
            position: relative;
            background: rgba(8,10,18,0.82);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
        }
        .glass::before,
        .glass::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 80px;
            pointer-events: none;
            z-index: 1;
        }
        .glass::before {
            top: -80px;
            background: linear-gradient(to bottom, transparent, rgba(8,10,18,0.82));
        }
        .glass::after {
            bottom: -80px;
            background: linear-gradient(to top, transparent, rgba(8,10,18,0.82));
        }
        .max-w { max-width: 1200px; margin: 0 auto; }

        .eyebrow {
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 0.75rem;
            display: block;
        }
        .heading {
            font-size: clamp(2rem, 4.5vw, 3.25rem);
            font-weight: 600;
            line-height: 1.08;
            letter-spacing: -0.025em;
            margin-bottom: 2rem;
        }
        .body { font-size: 0.9rem; color: var(--dim); line-height: 1.75; }

        /* Reveal */
        .r { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.16,1,0.3,1); }
        .r.v { opacity: 1; transform: none; }
        .d1 { transition-delay: 0.12s; }
        .d2 { transition-delay: 0.24s; }
        .d3 { transition-delay: 0.36s; }

        /* === ABOUT === */
        .about-cols {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            gap: 4rem;
        }
        .about-cols p { margin-bottom: 1rem; }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .stat-box {
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 6px;
            padding: 1.25rem;
            background: rgba(255,255,255,0.02);
        }
        .stat-lbl {
            font-size: 0.55rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--dim);
            margin-bottom: 0.3rem;
            display: block;
        }
        .stat-val { font-weight: 600; font-size: 0.9rem; }

        /* === VISION === */
        .vision-quote {
            font-size: clamp(1.5rem, 3.5vw, 2.5rem);
            font-weight: 300;
            line-height: 1.3;
            max-width: 850px;
            margin-bottom: 4rem;
        }
        .vision-quote span { color: var(--accent); }
        .v-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        .v-card {
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 8px;
            padding: 2rem;
            background: rgba(255,255,255,0.015);
            transition: border-color 0.3s, background 0.3s;
        }
        .v-card:hover {
            border-color: rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.03);
        }
        .v-card h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .v-card p { font-size: 0.82rem; color: var(--dim); line-height: 1.65; }

        /* === PILLARS === */
        .pill-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0;
        }
        .pill {
            padding: 2.5rem;
            border: 1px solid rgba(255,255,255,0.04);
            transition: background 0.3s;
        }
        .pill:hover { background: rgba(255,255,255,0.02); }
        .pill-n {
            font-size: 3.5rem;
            font-weight: 700;
            color: rgba(255,255,255,0.04);
            line-height: 1;
            margin-bottom: 1rem;
        }
        .pill h3 { font-size: 1.05rem; font-weight: 600; margin-bottom: 0.75rem; }
        .pill p { font-size: 0.82rem; color: var(--dim); line-height: 1.65; }

        /* === PROJECT === */
        .proj-img {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }
        .proj-img img { width: 100%; height: auto; display: block; }
        .img-credit {
            display: block;
            font-size: 0.68rem;
            color: var(--dim);
            margin-top: 0.5rem;
        }
        .img-credit em { font-style: italic; }
        .proj-tag {
            font-size: 0.6rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--dim);
            margin-bottom: 0.5rem;
            display: block;
        }
        .proj-cols {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 0.5rem;
        }
        .proj-cols p { font-size: 0.88rem; color: var(--dim); line-height: 1.75; margin-bottom: 0.5rem; }
        .proj-credit {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.2);
            margin-top: 1rem;
        }

        /* Panorama viewer */
        .pano-container {
            width: 100%;
            height: 350px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 0.75rem;
            cursor: grab;
            position: relative;
        }
        .pano-container:active { cursor: grabbing; }
        .pano-hint {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.3);
            z-index: 5;
            pointer-events: none;
            animation: fadeHint 3s ease 2s forwards;
        }
        @keyframes fadeHint { to { opacity: 0; } }

        /* Image gallery below pano */
        .img-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-top: 0.75rem;
        }
        .img-row img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            object-position: center top;
            border-radius: 6px;
            display: block;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        .img-row img:hover { opacity: 1; }
        .img-row figcaption {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.25);
            margin-top: 0.4rem;
        }

        /* === PEOPLE === */
        .dir-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 3rem;
            align-items: start;
            margin-bottom: 3rem;
        }
        .dir-nameblock h3 { font-size: 1.5rem; font-weight: 600; }
        .dir-nameblock .role {
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 0.2rem;
        }
        .dir-bio p {
            font-size: 0.88rem;
            color: var(--dim);
            line-height: 1.75;
            margin-bottom: 0.75rem;
        }
        .dir-bio a { color: var(--accent); text-decoration: none; }
        .dir-bio a:hover { text-decoration: underline; }

        .mem-label {
            font-size: 0.6rem;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--dim);
            margin-bottom: 1.25rem;
            display: block;
        }
        .mem-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        .mem {
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 8px;
            padding: 1.75rem;
            background: rgba(255,255,255,0.015);
            transition: border-color 0.3s;
        }
        .mem:hover { border-color: rgba(255,255,255,0.12); }
        .mem h4 { font-size: 1rem; font-weight: 600; margin-bottom: 0.15rem; }
        .mem .mrole { font-size: 0.68rem; color: var(--accent); margin-bottom: 0.75rem; display: block; }
        .mem p { font-size: 0.82rem; color: var(--dim); line-height: 1.6; }

        /* === CONTACT === */
        .c-flex {
            display: flex;
            gap: 5rem;
        }
        .c-label {
            font-size: 0.55rem;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: rgba(255,255,255,0.25);
            margin-bottom: 0.3rem;
            display: block;
        }
        .c-flex p { font-size: 0.88rem; color: var(--dim); }
        .c-flex a { color: var(--white); text-decoration: none; }
        .c-flex a:hover { text-decoration: underline; }

        /* === FOOTER === */
        footer {
            padding: 2rem 2.5rem;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.04);
        }
        footer p { font-size: 0.7rem; color: rgba(255,255,255,0.2); }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .about-cols, .proj-cols { grid-template-columns: 1fr; }
            .v-grid { grid-template-columns: 1fr; }
            .pill-grid { grid-template-columns: 1fr; }
            .dir-grid { grid-template-columns: 1fr; }
            .mem-grid { grid-template-columns: 1fr; }
            .img-row { grid-template-columns: 1fr; }
            .c-flex { flex-direction: column; gap: 2rem; }
            .pano-container { height: 250px; }
        }
    </style>
</head>
<body>

    <!-- ASCII 3D BACKGROUND -->
    <div id="ascii-canvas"></div>

    <div class="scroll-content">

        <nav>
            <a href="#" class="logo">CIL</a>
            <ul class="nav-links">
                <li><a href="#about">About</a></li>
                <li><a href="#vision">Vision</a></li>
                <li><a href="#project">Projects</a></li>
                <li><a href="#people">People</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>

        <header class="hero">
            <div style="text-align:center">
                <p class="hero-label r">University of Macau &middot; Arts &amp; Design</p>
                <h1 class="r d1">Creative<br>Intelligence<br>Lab</h1>
                <p class="hero-sub r d2">Where artificial intelligence meets artistic practice.</p>
            </div>
        </header>

        <section id="about" class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">About</span>
                <h2 class="heading r">A hub for AI-driven art &amp; design research</h2>
                <div class="about-cols r d1">
                    <div>
                        <p class="body">The Creative Intelligence Lab (CIL) is a research lab in the Department of Arts and Design, Faculty of Arts and Humanities at the University of Macau. We serve as a hub for investigating the creative potential of artificial intelligence&mdash;bridging traditional artistic practices with emerging technologies to discover new forms of expression.</p>
                        <p class="body">The lab pursues two interconnected goals: to develop practical principles and methodologies for incorporating generative AI into art and design practice and education, and to provide a collaborative space where students and researchers can experiment with cutting-edge AI tools in the pursuit of meaningful creative work.</p>
                        <p class="body">Through practice-based research, international collaboration, and publicly engaged creative output, the lab aims to position the University of Macau as a leader in AI-driven art and design research in the Greater Bay Area and beyond.</p>
                    </div>
                    <div class="stats">
                        <div class="stat-box"><span class="stat-lbl">Faculty</span><span class="stat-val">Arts &amp; Humanities</span></div>
                        <div class="stat-box"><span class="stat-lbl">Department</span><span class="stat-val">Arts &amp; Design</span></div>
                        <div class="stat-box"><span class="stat-lbl">Established</span><span class="stat-val">2025</span></div>
                        <div class="stat-box"><span class="stat-lbl">Location</span><span class="stat-val">Macau, Taipa</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Transparent spacer — ASCII shows through -->
        <div class="spacer" style="height:60vh"></div>

        <section id="vision" class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">Vision</span>
                <div class="vision-quote r">AI as a tool for <span>augmenting</span> human creativity&mdash;enhancing skills and intuition rather than replacing established artistic practices.</div>
                <div class="v-grid">
                    <div class="v-card r d1"><h3>Beyond the Hype</h3><p>Our approach to AI integration is rooted in sustainability&mdash;moving past short-lived trends to focus on long-term impact.</p></div>
                    <div class="v-card r d2"><h3>Tradition &amp; Innovation</h3><p>We explore how AI reshapes creative production while maintaining connections to traditional art forms and cultural heritage.</p></div>
                    <div class="v-card r d1"><h3>Open &amp; Adaptable</h3><p>Open-source technologies and adaptable frameworks that can be customized for diverse institutional and cultural contexts.</p></div>
                    <div class="v-card r d2"><h3>Tangible Outcomes</h3><p>Exhibitions, design products, publications, and public installations that directly engage with the contemporary world.</p></div>
                </div>
            </div>
        </section>

        <div class="spacer" style="height:50vh"></div>

        <section class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">Focus Areas</span>
                <h2 class="heading r">Three pillars of inquiry</h2>
                <div class="pill-grid r d1">
                    <div class="pill"><div class="pill-n">01</div><h3>Research &amp; Development</h3><p>Investigating new applications for AI in art and design through practice-based research, human-AI collaboration, and next-generation creative tools.</p></div>
                    <div class="pill"><div class="pill-n">02</div><h3>Creative Production</h3><p>High-performance computing, open-source AI tools, digital fabrication. Work spanning generative imagery, AI-driven live performance, immersive media, and installation.</p></div>
                    <div class="pill"><div class="pill-n">03</div><h3>Knowledge Exchange</h3><p>International partnerships, workshops, exhibitions, and scholarly publications fostering cross-disciplinary collaboration.</p></div>
                </div>
            </div>
        </section>

        <div class="spacer" style="height:50vh"></div>

        <section id="project" class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">Selected Projects</span>
                <div class="proj-img r">
                    <img src="../../images/mars-impression-painting.jpg" alt="Mars Impression by Hung Hoi">
                    <span class="img-credit"><em>Mars Impression</em>, Hung Hoi (&#29066;&#28023;), 2025. Ink and colour on paper.</span>
                </div>
                <span class="proj-tag r">AI &middot; VR &middot; Planetary Science &middot; Chinese Ink Painting</span>
                <h2 class="heading r">Celestial Impression</h2>
                <div class="proj-cols r d1">
                    <p>Celestial Impression is a collaboration between the Creative Intelligence Lab and esteemed Hong Kong ink artist Hung Hoi. Building on the earlier Mars Impression project&mdash;in which Hung Hoi created large-scale ink paintings of the Martian surface after experiencing NASA panoramas in VR&mdash;the project extends the same art-science methodology to the Moon.</p>
                    <div>
                        <p>The technical team develops two innovative pipelines: multi-image stitching of archival NASA photography combined with AI inpainting to produce seamless 360-degree panoramas, and AI-enhanced generation from low-resolution LROC data using custom ComfyUI workflows.</p>
                        <div class="proj-credit">Studio Pollen &middot; Creative Intelligence Lab</div>
                    </div>
                </div>

                <!-- Interactive panorama viewer -->
                <div class="pano-container" id="pano-viewer">
                    <span class="pano-hint">Drag to explore Tycho Crater</span>
                </div>

                <div class="img-row r">
                    <figure><img src="../../images/hung-hoi-vr-studio.jpg" alt="Hung Hoi in VR"><figcaption>Hung Hoi in VR at his Hong Kong studio</figcaption></figure>
                    <figure><img src="../../images/vr-landscape-sketch.jpg" alt="VR sketch"><figcaption>VR landscape sketch on the Martian surface</figcaption></figure>
                    <figure><img src="../../images/komarov-crater-panorama.jpg" alt="Komarov Crater"><figcaption>Komarov Crater &mdash; AI-enhanced from LROC</figcaption></figure>
                    <figure><img src="../../images/apollo-surface-panorama.jpg" alt="Apollo lunar surface"><figcaption>Apollo landing site &mdash; stitched panorama</figcaption></figure>
                </div>
            </div>
        </section>

        <div class="spacer" style="height:50vh"></div>

        <section id="people" class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">People</span>
                <h2 class="heading r">The team</h2>

                <div class="dir-grid r d1">
                    <div class="dir-nameblock">
                        <h3>Atticus Sims</h3>
                        <div class="role">Assoc. Prof., AI &amp; Design</div>
                    </div>
                    <div class="dir-bio">
                        <p>Atticus Sims is an Associate Professor of Interdisciplinary Research in Artificial Intelligence and Design at the University of Macau, within the Faculty of Arts and Humanities, <a href="https://fah.um.edu.mo/dad/" target="_blank" rel="noopener">Department of Arts and Design</a>. He is an interdisciplinary researcher and educator focused on integrating AI technologies into creative practices and art and design education.</p>
                        <p>Previously a specially appointed associate professor at Kyoto Seika University&rsquo;s Faculty of Media Creation, he led a president-funded investigation into pedagogical frameworks for emerging AI tools. His research examines the systematic implementation of diffusion models and generative frameworks in art and design production.</p>
                        <p>This academic work is complemented by industry experience as the founder of KYOTO VR, an immersive media production company. Current projects include <em>The Metamorphosis of Plants</em> exhibition and a permanent installation at Hong Kong Baptist University.</p>
                        <p>He is a co-founder of <a href="https://www.studio-pollen.com/" target="_blank" rel="noopener">Studio Pollen</a>, an art, science and technology collective with members based across Kyoto, Macau and Hong Kong.</p>
                    </div>
                </div>

                <span class="mem-label r">Members</span>
                <div class="mem-grid">
                    <div class="mem r d1"><h4>Ethan Quan</h4><span class="mrole">Doctoral Student, VCD</span><p>Art and creative designer, former Senior UX Designer at vivo and Xiaomi. Research focuses on the visual design of consumer electronic systems.</p></div>
                    <div class="mem r d2"><h4>Lawrence Song</h4><span class="mrole">Doctoral Student, VCD</span><p>Designer and creative technologist at the intersection of computation and visual/experiential design. Creates electronic content, interactive experiences, and immersive environments.</p></div>
                    <div class="mem r d3"><h4>Joanna Yan</h4><span class="mrole">Doctoral Student, VCD</span><p>UK-Chartered Landscape Architect and visual artist. Nearly a decade of international practice, now focused on immersive spatial experiences and AIGC-driven interactive art.</p></div>
                </div>
            </div>
        </section>

        <div class="spacer" style="height:40vh"></div>

        <section id="contact" class="s-pad glass">
            <div class="max-w">
                <span class="eyebrow r">Contact</span>
                <h2 class="heading r" style="margin-bottom:1rem;">Get in touch</h2>
                <p class="body r" style="max-width:500px;margin-bottom:2rem;">We welcome inquiries from prospective students, potential collaborators, and fellow researchers.</p>
                <div class="c-flex r d1">
                    <div><span class="c-label">Email</span><p><a href="mailto:atticussims@um.edu.mo">atticussims@um.edu.mo</a></p></div>
                    <div><span class="c-label">Location</span><p>Department of Arts and Design<br>Faculty of Arts and Humanities<br>University of Macau, Taipa<br>Macau SAR, China</p></div>
                </div>
            </div>
        </section>

        <footer>
            <p>&copy; 2025&ndash;2026 Creative Intelligence Lab, University of Macau</p>
        </footer>

    </div>

    <!-- THREE.JS (for panorama viewer only) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
    (function() {
        // =========================================================
        //  ASCII GRID FIELD
        //
        //  A dense monospaced character grid covering the viewport,
        //  driven by layered simplex noise. Character density and
        //  brightness create flowing organic patterns that morph
        //  over time. Subtle horizontal scanlines add texture.
        //
        //  Opacity responds to scroll position — dimmed over glass
        //  content sections, pronounced in transparent spacers,
        //  with fast transitions that begin at section edges.
        // =========================================================

        // --- Simplex Noise (compact 2D/3D implementation) ---
        // Based on Stefan Gustavson's simplex noise
        const F2 = 0.5 * (Math.sqrt(3) - 1);
        const G2 = (3 - Math.sqrt(3)) / 6;
        const F3 = 1/3, G3 = 1/6;

        const grad3 = [[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],
                        [1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],
                        [0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];
        const perm = new Uint8Array(512);
        const p = [151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,
            140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,
            247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,
            57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,
            74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,
            60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,
            65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,
            200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,
            52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,
            207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,
            119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,
            129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,
            218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,
            81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,
            184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,
            222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];
        for (let i = 0; i < 256; i++) { perm[i] = perm[i + 256] = p[i]; }

        function noise2D(x, y) {
            const s = (x + y) * F2;
            const i = Math.floor(x + s), j = Math.floor(y + s);
            const t = (i + j) * G2;
            const x0 = x - (i - t), y0 = y - (j - t);
            const i1 = x0 > y0 ? 1 : 0, j1 = x0 > y0 ? 0 : 1;
            const x1 = x0 - i1 + G2, y1 = y0 - j1 + G2;
            const x2 = x0 - 1 + 2*G2, y2 = y0 - 1 + 2*G2;
            const ii = i & 255, jj = j & 255;
            let n0=0, n1=0, n2=0;
            let t0 = 0.5 - x0*x0 - y0*y0;
            if (t0 > 0) { t0 *= t0; const g = grad3[perm[ii+perm[jj]] % 12]; n0 = t0*t0*(g[0]*x0+g[1]*y0); }
            let t1 = 0.5 - x1*x1 - y1*y1;
            if (t1 > 0) { t1 *= t1; const g = grad3[perm[ii+i1+perm[jj+j1]] % 12]; n1 = t1*t1*(g[0]*x1+g[1]*y1); }
            let t2 = 0.5 - x2*x2 - y2*y2;
            if (t2 > 0) { t2 *= t2; const g = grad3[perm[ii+1+perm[jj+1]] % 12]; n2 = t2*t2*(g[0]*x2+g[1]*y2); }
            return 70 * (n0 + n1 + n2);
        }

        function noise3D(x, y, z) {
            const s = (x+y+z)*F3;
            const i=Math.floor(x+s), j=Math.floor(y+s), k=Math.floor(z+s);
            const t=(i+j+k)*G3;
            const x0=x-(i-t), y0=y-(j-t), z0=z-(k-t);
            let i1,j1,k1,i2,j2,k2;
            if(x0>=y0){if(y0>=z0){i1=1;j1=0;k1=0;i2=1;j2=1;k2=0;}else if(x0>=z0){i1=1;j1=0;k1=0;i2=1;j2=0;k2=1;}else{i1=0;j1=0;k1=1;i2=1;j2=0;k2=1;}}
            else{if(y0<z0){i1=0;j1=0;k1=1;i2=0;j2=1;k2=1;}else if(x0<z0){i1=0;j1=1;k1=0;i2=0;j2=1;k2=1;}else{i1=0;j1=1;k1=0;i2=1;j2=1;k2=0;}}
            const x1=x0-i1+G3,y1=y0-j1+G3,z1=z0-k1+G3;
            const x2=x0-i2+2*G3,y2=y0-j2+2*G3,z2=z0-k2+2*G3;
            const x3=x0-1+3*G3,y3=y0-1+3*G3,z3=z0-1+3*G3;
            const ii=i&255,jj=j&255,kk=k&255;
            let n0=0,n1=0,n2=0,n3=0;
            let t0=0.6-x0*x0-y0*y0-z0*z0;if(t0>0){t0*=t0;const g=grad3[perm[ii+perm[jj+perm[kk]]]%12];n0=t0*t0*(g[0]*x0+g[1]*y0+g[2]*z0);}
            let t1=0.6-x1*x1-y1*y1-z1*z1;if(t1>0){t1*=t1;const g=grad3[perm[ii+i1+perm[jj+j1+perm[kk+k1]]]%12];n1=t1*t1*(g[0]*x1+g[1]*y1+g[2]*z1);}
            let t2=0.6-x2*x2-y2*y2-z2*z2;if(t2>0){t2*=t2;const g=grad3[perm[ii+i2+perm[jj+j2+perm[kk+k2]]]%12];n2=t2*t2*(g[0]*x2+g[1]*y2+g[2]*z2);}
            let t3=0.6-x3*x3-y3*y3-z3*z3;if(t3>0){t3*=t3;const g=grad3[perm[ii+1+perm[jj+1+perm[kk+1]]]%12];n3=t3*t3*(g[0]*x3+g[1]*y3+g[2]*z3);}
            return 32*(n0+n1+n2+n3);
        }

        // Fractal brownian motion — layered noise octaves
        function fbm(x, y, z, octaves) {
            let val = 0, amp = 0.5, freq = 1;
            for (let i = 0; i < octaves; i++) {
                val += amp * noise3D(x*freq, y*freq, z*freq);
                amp *= 0.5;
                freq *= 2;
            }
            return val;
        }

        // --- Canvas setup ---
        const container = document.getElementById('ascii-canvas');
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        container.appendChild(canvas);

        // Character pools — diverse characters grouped by visual density
        // Lightest (sparse dots, thin strokes) → heaviest (dense blocks)
        const lightChars  = ' .,-\'`·:;';
        const medLtChars  = '~_^"!|/\\(){}[]<>ir1l';
        const medChars    = '*+?=csxz7tfjn23e5ao';
        const medHvChars  = 'vukydpqSECG6890$&4A';
        const heavyChars  = '#%@WMBNRHDK';
        const allPools = [lightChars, medLtChars, medChars, medHvChars, heavyChars];

        function charFromDensity(val) {
            // val 0-1 → pick pool, then random char within pool
            const poolIdx = Math.min(Math.floor(val * allPools.length), allPools.length - 1);
            const pool = allPools[poolIdx];
            return pool[Math.floor(Math.random() * pool.length)];
        }

        // Pre-generate a character lookup grid that updates periodically
        // This avoids calling Math.random() per cell per frame and gives
        // a more stable, text-like appearance
        let charGrid = [];
        let charGridStale = true;
        let lastCharUpdate = 0;
        const charUpdateInterval = 0.15; // seconds between partial refreshes

        // Grid sizing
        const fontSize = 12;
        const cellW = fontSize * 0.62;   // monospace char width
        const cellH = fontSize * 1.18;   // line height with scanline gap
        let cols, rows;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            cols = Math.ceil(canvas.width / cellW);
            rows = Math.ceil(canvas.height / cellH);
            charGridStale = true;
        }
        resize();
        window.addEventListener('resize', resize);

        // --- Section visibility (continuous blend, not binary) ---
        // Instead of binary on/off, compute a smooth 0-1 value based
        // on proximity to nearest glass section edge. This makes the
        // transition begin as soon as the user starts scrolling away
        // from a section, not just at the midpoint.
        let globalDim = 0; // 0 = full brightness (spacer), 1 = dimmed (content)

        const glassSections = document.querySelectorAll('.glass');

        function computeDim() {
            // For each pixel row on screen, determine max overlap with glass
            // We use a simpler approach: compute what fraction of the
            // viewport is covered by glass sections
            let coveredPx = 0;
            const vh = window.innerHeight;

            glassSections.forEach(sec => {
                const rect = sec.getBoundingClientRect();
                const visTop = Math.max(0, rect.top);
                const visBot = Math.min(vh, rect.bottom);
                if (visBot > visTop) coveredPx += (visBot - visTop);
            });

            // Fraction of viewport covered by glass
            const frac = Math.min(coveredPx / vh, 1);
            // Use a curve to make transitions snappier at edges
            return frac * frac * (3 - 2 * frac); // smoothstep
        }

        // --- Mouse tracking ---
        let mouseX = -1000, mouseY = -1000;
        document.addEventListener('mousemove', e => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        document.addEventListener('mouseleave', () => {
            mouseX = -1000;
            mouseY = -1000;
        });

        // --- Scroll tracking ---
        let scrollY = 0;
        window.addEventListener('scroll', () => { scrollY = window.pageYOffset; });

        // --- Main render loop ---
        let time = 0;
        const startTime = performance.now();

        // Color: subdued base blue that doesn't compete with text,
        // but brightens significantly near the mouse cursor.
        // Ambient field stays dark (max ~55%), mouse spotlight pushes to 78%.
        function getColor(scrollRatio, brightness) {
            const h = 220 + scrollRatio * 25;
            const s = 55 + brightness * 30;  // 55% → 85%
            const l = 28 + brightness * 27;  // 28% base → 55% at ambient peak
            return `hsl(${h}, ${s}%, ${l}%)`;
        }

        // Pre-compute a noise field at lower resolution, then interpolate
        // This cuts noise calls by ~16x (4x4 sampling blocks)
        const SAMPLE = 4; // sample every Nth cell
        let noiseField = null;
        let fieldCols = 0, fieldRows = 0;

        function buildNoiseField(t) {
            fieldCols = Math.ceil(cols / SAMPLE) + 2;
            fieldRows = Math.ceil(rows / SAMPLE) + 2;
            if (!noiseField || noiseField.length !== fieldRows) {
                noiseField = new Array(fieldRows);
                for (let r = 0; r < fieldRows; r++) noiseField[r] = new Float32Array(fieldCols);
            }

            const ns1 = 0.015, ns2 = 0.04, ns3 = 0.08;

            for (let sr = 0; sr < fieldRows; sr++) {
                const py = sr * SAMPLE * cellH;
                for (let sc = 0; sc < fieldCols; sc++) {
                    const px = sc * SAMPLE * cellW;

                    const n1 = fbm(px * ns1, py * ns1, t, 3);
                    const n2 = noise3D(px * ns2, py * ns2, t * 1.4 + 100);
                    const n3 = noise2D(px * ns3 + t * 0.6, py * ns3 + 50);

                    let val = n1 * 0.5 + n2 * 0.3 + n3 * 0.2;
                    val = val * 0.5 + 0.5; // remap to 0-1
                    noiseField[sr][sc] = val;
                }
            }
        }

        // Bilinear interpolation of noise field
        function sampleNoise(col, row) {
            const fx = col / SAMPLE;
            const fy = row / SAMPLE;
            const x0 = Math.floor(fx), y0 = Math.floor(fy);
            const x1 = Math.min(x0 + 1, fieldCols - 1);
            const y1 = Math.min(y0 + 1, fieldRows - 1);
            const sx = fx - x0, sy = fy - y0;

            const v00 = noiseField[y0][x0], v10 = noiseField[y0][x1];
            const v01 = noiseField[y1][x0], v11 = noiseField[y1][x1];

            return (v00 * (1-sx) + v10 * sx) * (1-sy) + (v01 * (1-sx) + v11 * sx) * sy;
        }

        // Pre-compute a stable character grid (updated in rolling waves)
        let charGridArr = null;
        let charSeedArr = null;

        function initCharGrid() {
            charGridArr = new Array(rows * cols);
            charSeedArr = new Uint8Array(rows * cols);
            for (let i = 0; i < rows * cols; i++) {
                charSeedArr[i] = Math.floor(Math.random() * 256);
            }
        }

        function render() {
            requestAnimationFrame(render);
            time = (performance.now() - startTime) / 1000;

            // Smooth dim transition
            const targetDim = computeDim();
            globalDim += (targetDim - globalDim) * 0.12;

            const maxScroll = document.body.scrollHeight - window.innerHeight;
            const scrollRatio = maxScroll > 0 ? Math.min(scrollY / maxScroll, 1) : 0;

            // Init char grid if needed
            if (!charGridArr || charGridArr.length !== rows * cols) initCharGrid();

            // Build noise field for this frame
            const t = time * 0.07;
            buildNoiseField(t);

            // Clear
            ctx.fillStyle = '#080a12';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.font = `${fontSize}px "Courier New", "Courier", monospace`;
            ctx.textBaseline = 'top';

            // Opacity range: spacer ~0.72, glass ~0.07
            const baseAlpha = 0.07 + (1 - globalDim) * 0.65;
            const mouseRadius = 250;

            // Rolling char update — cycle through a wave each frame
            // Update a band of rows per frame for morphing effect
            const waveSpeed = 2.5; // rows per frame
            const waveRow = Math.floor((time * waveSpeed * 10) % rows);
            const waveWidth = 3;
            for (let dr = 0; dr < waveWidth; dr++) {
                const rr = (waveRow + dr) % rows;
                for (let cc = 0; cc < cols; cc++) {
                    const idx = rr * cols + cc;
                    charSeedArr[idx] = (charSeedArr[idx] + 1) & 255;
                }
            }

            // Pre-compute color steps (5 brightness levels to avoid
            // changing fillStyle per character)
            const colorSteps = 8;
            const colors = [];
            for (let i = 0; i < colorSteps; i++) {
                const b = i / (colorSteps - 1);
                colors.push(getColor(scrollRatio, b));
            }

            for (let row = 0; row < rows; row++) {
                const py = row * cellH;

                for (let col = 0; col < cols; col++) {
                    const px = col * cellW;

                    // Sample interpolated noise
                    let val = sampleNoise(col, row);

                    // Vignette
                    const cx = (px / canvas.width - 0.5) * 2;
                    const cy = (py / canvas.height - 0.5) * 2;
                    val *= Math.max(0, 1 - (cx*cx + cy*cy) * 0.12);

                    // Mouse boost — stronger to create visible glow
                    const dx = px - mouseX;
                    const dy = py - mouseY;
                    const md2 = dx*dx + dy*dy;
                    if (md2 < mouseRadius * mouseRadius) {
                        const mf = 1 - Math.sqrt(md2) / mouseRadius;
                        val += mf * mf * 0.7;
                    }

                    val = Math.max(0, Math.min(1, val));

                    if (val < 0.06) continue;

                    // Pick character from density pool
                    const poolIdx = Math.min(Math.floor(val * allPools.length), allPools.length - 1);
                    const pool = allPools[poolIdx];
                    const idx = row * cols + col;
                    const ch = pool[charSeedArr[idx] % pool.length];

                    // Alpha
                    const alpha = (0.12 + val * 0.88) * baseAlpha;
                    if (alpha < 0.015) continue;

                    // Color step
                    const ci = Math.min(Math.floor(val * colorSteps), colorSteps - 1);
                    ctx.fillStyle = colors[ci];
                    ctx.globalAlpha = alpha;
                    ctx.fillText(ch, px, py);
                }
            }

            // Scanlines
            ctx.globalAlpha = 0.04 + (1 - globalDim) * 0.07;
            ctx.fillStyle = '#000000';
            for (let y = 0; y < canvas.height; y += cellH) {
                ctx.fillRect(0, y + cellH - 1, canvas.width, 1);
            }

            ctx.globalAlpha = 1;
        }
        render();

        // === PANORAMA SPHERE VIEWER ===
        const panoEl = document.getElementById('pano-viewer');
        if (panoEl) {
            const pScene = new THREE.Scene();
            const pCam = new THREE.PerspectiveCamera(55, panoEl.clientWidth / panoEl.clientHeight, 0.1, 1000);
            pCam.position.set(0, 0, 0.01);

            const pRenderer = new THREE.WebGLRenderer({ antialias: true });
            pRenderer.setSize(panoEl.clientWidth, panoEl.clientHeight);
            pRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            panoEl.appendChild(pRenderer.domElement);

            const sphereGeo = new THREE.SphereGeometry(50, 60, 40);
            sphereGeo.scale(-1, 1, 1);
            const tex = new THREE.TextureLoader().load('../../images/tycho-crater-panorama.jpg');
            const sphereMat = new THREE.MeshBasicMaterial({ map: tex });
            const sphere = new THREE.Mesh(sphereGeo, sphereMat);
            pScene.add(sphere);

            let isDragging = false;
            let prevX = 0, prevY = 0;
            let lon = -15, lat = -8;  // Start facing the Tycho central peak

            panoEl.addEventListener('pointerdown', (e) => {
                isDragging = true;
                prevX = e.clientX;
                prevY = e.clientY;
            });
            window.addEventListener('pointerup', () => { isDragging = false; });
            window.addEventListener('pointermove', (e) => {
                if (!isDragging) return;
                lon -= (e.clientX - prevX) * 0.2;
                lat += (e.clientY - prevY) * 0.2;
                lat = Math.max(-85, Math.min(85, lat));
                prevX = e.clientX;
                prevY = e.clientY;
            });

            function animatePano() {
                requestAnimationFrame(animatePano);
                if (!isDragging) lon += 0.02;
                const phi = THREE.MathUtils.degToRad(90 - lat);
                const theta = THREE.MathUtils.degToRad(lon);
                const target = new THREE.Vector3(
                    50 * Math.sin(phi) * Math.cos(theta),
                    50 * Math.cos(phi),
                    50 * Math.sin(phi) * Math.sin(theta)
                );
                pCam.lookAt(target);
                pRenderer.render(pScene, pCam);
            }
            animatePano();

            const ro = new ResizeObserver(() => {
                pCam.aspect = panoEl.clientWidth / panoEl.clientHeight;
                pCam.updateProjectionMatrix();
                pRenderer.setSize(panoEl.clientWidth, panoEl.clientHeight);
            });
            ro.observe(panoEl);
        }

        // === SCROLL REVEALS ===
        const rObs = new IntersectionObserver((entries) => {
            entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('v'); });
        }, { threshold: 0.08 });
        document.querySelectorAll('.r').forEach(el => rObs.observe(el));
    })();
    </script>
</body>
</html>
